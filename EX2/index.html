<!DOCTYPE html>
<html>
<head>
    <title>Playfair Cipher</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        input, button {
            padding: 6px;
            margin: 5px 0;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

<h2>Playfair Cipher (Encryption & Decryption)</h2>

<label>Enter Key:</label><br>
<input type="text" id="key"><br><br>

<label>Enter Plaintext:</label><br>
<input type="text" id="plaintext"><br><br>

<button onclick="runPlayfair()">Run Cipher</button>

<pre id="output"></pre>

<script>
function generateKeyMatrix(key) {
    key = key.toUpperCase().replace(/J/g, "I"); // Convert to uppercase and replace J with I
    let seen = new Set();                       // Track used characters
    let matrix = [];

    // Add unique letters from key
    for (let char of key) {
        if (char >= 'A' && char <= 'Z' && !seen.has(char)) {
            seen.add(char);
            matrix.push(char);
        }
    }

    // Add remaining alphabets (Aâ€“Z except J)
    for (let i = 65; i <= 90; i++) {
        let char = String.fromCharCode(i);
        if (char === 'J') continue;
        if (!seen.has(char)) {
            matrix.push(char);
        }
    }

    // Convert to 5x5 matrix
    let grid = [];
    for (let i = 0; i < 25; i += 5) {
        grid.push(matrix.slice(i, i + 5));
    }
    return grid;
}

function findPosition(matrix, char) {
    for (let r = 0; r < 5; r++) {
        for (let c = 0; c < 5; c++) {
            if (matrix[r][c] === char) {
                return [r, c]; // Return row and column
            }
        }
    }
}

function prepareText(text) {
    text = text.toUpperCase().replace(/J/g, "I").replace(/[^A-Z]/g, "");
    let result = "";
    let i = 0;

    while (i < text.length) {
        result += text[i];
        if (i + 1 < text.length) {
            if (text[i] === text[i + 1]) {
                result += "X";     // Insert X for repeated letters
            } else {
                result += text[i + 1];
                i++;
            }
        }
        i++;
    }

    if (result.length % 2 !== 0) {
        result += "X";              // Pad X if length is odd
    }

    return result;
}

function encrypt(plaintext, key, output) {
    let matrix = generateKeyMatrix(key);
    let text = prepareText(plaintext);
    let cipher = "";

    output.push("Prepared Plaintext: " + text);
    output.push("\nEncryption Steps:");

    for (let i = 0; i < text.length; i += 2) {
        let a = text[i], b = text[i + 1];           // Take a pair of letters
        let [r1, c1] = findPosition(matrix, a);     // Position of first letter
        let [r2, c2] = findPosition(matrix, b);     // Position of second letter

        output.push(`\nPair: ${a}${b}`);
        output.push(`Positions: ${a}(${r1},${c1}), ${b}(${r2},${c2})`);

        let e1, e2;

        if (r1 === r2) { // Same row
            e1 = matrix[r1][(c1 + 1) % 5];
            e2 = matrix[r2][(c2 + 1) % 5];
            output.push("Rule: Same Row");
        } else if (c1 === c2) { // Same column
            e1 = matrix[(r1 + 1) % 5][c1];
            e2 = matrix[(r2 + 1) % 5][c2];
            output.push("Rule: Same Column");
        } else { // Rectangle rule
            e1 = matrix[r1][c2];
            e2 = matrix[r2][c1];
            output.push("Rule: Rectangle");
        }

        cipher += e1 + e2;
        output.push("Encrypted Pair: " + e1 + e2);
    }

    return cipher;
}

function decrypt(ciphertext, key, output) {
    let matrix = generateKeyMatrix(key);
    let plain = "";

    output.push("\nDecryption Steps:");

    for (let i = 0; i < ciphertext.length; i += 2) {
        let a = ciphertext[i], b = ciphertext[i + 1];
        let [r1, c1] = findPosition(matrix, a);
        let [r2, c2] = findPosition(matrix, b);

        output.push(`\nPair: ${a}${b}`);
        output.push(`Positions: ${a}(${r1},${c1}), ${b}(${r2},${c2})`);

        let d1, d2;

        if (r1 === r2) { // Same row
            d1 = matrix[r1][(c1 + 4) % 5];
            d2 = matrix[r2][(c2 + 4) % 5];
            output.push("Rule: Same Row");
        } else if (c1 === c2) { // Same column
            d1 = matrix[(r1 + 4) % 5][c1];
            d2 = matrix[(r2 + 4) % 5][c2];
            output.push("Rule: Same Column");
        } else { // Rectangle rule
            d1 = matrix[r1][c2];
            d2 = matrix[r2][c1];
            output.push("Rule: Rectangle");
        }

        plain += d1 + d2;
        output.push("Decrypted Pair: " + d1 + d2);
    }

    return plain;
}

function runPlayfair() {
    let key = document.getElementById("key").value;
    let plaintext = document.getElementById("plaintext").value;
    let output = [];

    let matrix = generateKeyMatrix(key);
    output.push("Key Matrix:");
    matrix.forEach(row => output.push(row.join(" ")));

    let cipher = encrypt(plaintext, key, output);
    output.push("\nFinal Cipher Text: " + cipher);

    let decrypted = decrypt(cipher, key, output);
    output.push("\nFinal Decrypted Text: " + decrypted);

    document.getElementById("output").textContent = output.join("\n");
}
</script>

</body>
</html>
